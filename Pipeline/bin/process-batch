#!/usr/bin/perl
#
# Feed all related warcs files per source through a set of filters.
#

use warnings;
use strict;

use OSF::CommonCrawl::WarcSet  ();
use OSF::KB_NL_Fryslan::Filter ();
use OSF::LinkCollector::Filter ();
use File::Basename  qw(basename);

@ARGV==1
   or die "Usage: $0 <dir>\n";

my $workdir = $ARGV[0];
-d $workdir or die "ERROR: workdir '$workdir' does not exist\n";

my $cc = OSF::CommonCrawl::WarcSet->new(
  dir  => $workdir,
  name => basename($workdir),
);

my @filters;
push @filters, OSF::KB_NL_Fryslan::Filter->new;
push @filters, OSF::LinkCollector::Filter->new;

while(my $product = $cc->getProduct)
{   #print $product->part('request')->uri, "\n";

    $_->filter($product) for @filters;

#sleep 1;
}

$_->finish(batch => $cc) for @filters;
